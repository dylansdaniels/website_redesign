{
    "full_executed": true,
    "parallelism_joblib_notebook.ipynb": {
        "4.7: Parallelism: Using the Joblib backend": {
            "level": 1,
            "html": "<div class='markdown-cell'>\n    <h1>4.7: Parallelism: Using the Joblib backend</h1>\n<p>This example demonstrates how to use the Joblib backend for\nsimulating dipoles using <code>hnn_core</code>.</p>\n<p><code>hnn_core</code> can take advantage of <a\nhref=\"https://joblib.readthedocs.io/en/stable/\">the Joblib library</a>\nto run <strong>multiple</strong> independent simulations simultaneously\nacross <strong>multiple</strong> CPU processors. This is an example of\n<a\nhref=\"https://en.wikipedia.org/wiki/Embarrassingly_parallel\">\"embarrassingly\nparallel\" processing jobs</a>. In HNN, this is commonly done if you want\nto run many \"trials\" of the same simulation. Since each trial simulation\nis fully independent of the other trial simulations, each trial\nsimulation can be run on its own CPU core. Joblib parallelism is\nparticularly useful if you are using <a\nhref=\"https://dylansdaniels.github.io/website_redesign/content/04_using_hnn/batch_simulation.html\">batch\nsimulation to explore parameter spaces</a>.</p>\n<p>Note that to use Joblib parallelism, you need either the\n<code>conda</code> install or the <code>Joblib Installation</code>\ndependencies described <a\nhref=\"https://jonescompneurolab.github.io/hnn-core/dev/install.html\">in\nour Installation Guide here</a>.</p>\n<p>Note that Joblib parallelism is distinct from <code>hnn_core</code>'s\nuse of <a\nhref=\"https://dylansdaniels.github.io/website_redesign/content/04_using_hnn/parallelism_mpi.html\">MPI\nparallelism, which can be found here</a>.</p>\n\n</div>\n<div class='code-cell'>\n    <code class='language-python'>\n        # Authors: Mainak Jas <mjas@mgh.harvard.edu>\n#          Blake Caldwell <blake_caldwell@brown.edu>\n#          Austin Soplata <austin_soplata@brown.edu>\n    </code>\n</div>\n<div class='markdown-cell'>\n    <p>Let us import what we need from <code>hnn_core</code>:</p>\n\n</div>\n<div class='code-cell'>\n    <code class='language-python'>\n        import matplotlib.pyplot as plt\n\nfrom hnn_core import simulate_dipole, jones_2009_model\nfrom hnn_core.viz import plot_dipole\n    </code>\n</div>\n<div class='markdown-cell'>\n    <p>Following our <a\nhref=\"https://dylansdaniels.github.io/website_redesign/content/06_alpha_beta/api.html\">Alpha\nexample</a>, we will create our network and add a ~10 Hz \"bursty\"\ndrive:</p>\n\n</div>\n<div class='code-cell'>\n    <code class='language-python'>\n        net = jones_2009_model()\n\nweights_ampa = {'L2_pyramidal': 5.4e-5, 'L5_pyramidal': 5.4e-5}\nnet.add_bursty_drive(\n    'bursty', tstart=50., burst_rate=10, burst_std=20., numspikes=2,\n    spike_isi=10, n_drive_cells=10, location='distal',\n    weights_ampa=weights_ampa, event_seed=278)\n    </code>\n</div>\n<div class='markdown-cell'>\n    <p>Finally, we will simulate using the <a\nhref=\"https://jonescompneurolab.github.io/hnn-core/dev/generated/hnn_core.parallel_backends.JoblibBackend.html#hnn_core.parallel_backends.JoblibBackend\"><code>JoblibBackend</code>\nclass</a>. You can control the number of CPU cores to use via\n<code>n_jobs</code>, while the number of total trials to be run can be\nspecified by <code>n_trials</code>. Note that these numbers do NOT have\nto match: you can ask for more trials than there are jobs available, and\nJoblib will simply execute later jobs after the first batch has\ncompleted.</p>\n\n</div>\n<div class='code-cell'>\n    <code class='language-python'>\n        from hnn_core import JoblibBackend\n\nwith JoblibBackend(n_jobs=4):\n    dpls = simulate_dipole(net, tstop=210., n_trials=6)\n    </code>\n</div>\n<div class='output-cell'><div class='output-label'>\n    Out:\n</div>\n    <div class='output-code'>\n        Joblib will run 6 trial(s) in parallel by distributing trials over 4 jobs.\nBuilding the NEURON model\nBuilding the NEURON model\nLoading custom mechanism files from /opt/anaconda3/envs/website-redesign-mpi/lib/python3.12/site-packages/hnn_core/mod/arm64/.libs/libnrnmech.so\nBuilding the NEURON model\nLoading custom mechanism files from /opt/anaconda3/envs/website-redesign-mpi/lib/python3.12/site-packages/hnn_core/mod/arm64/.libs/libnrnmech.so\nBuilding the NEURON model\n[Done]\nTrial 2: 0.03 ms...\n[Done]\nTrial 4: 0.03 ms...\n[Done]\n[Done]\nTrial 3: 0.03 ms...\nTrial 1: 0.03 ms...\nTrial 2: 10.0 ms...\nTrial 4: 10.0 ms...\nTrial 1: 10.0 ms...\nTrial 3: 10.0 ms...\nTrial 2: 20.0 ms...\nTrial 4: 20.0 ms...\nTrial 3: 20.0 ms...\nTrial 1: 20.0 ms...\nTrial 2: 30.0 ms...\nTrial 4: 30.0 ms...\nTrial 3: 30.0 ms...\nTrial 1: 30.0 ms...\nTrial 2: 40.0 ms...\nTrial 4: 40.0 ms...\nTrial 3: 40.0 ms...\nTrial 1: 40.0 ms...\nTrial 2: 50.0 ms...\nTrial 4: 50.0 ms...\nTrial 3: 50.0 ms...\nTrial 1: 50.0 ms...\nTrial 2: 60.0 ms...\nTrial 4: 60.0 ms...\nTrial 3: 60.0 ms...\nTrial 1: 60.0 ms...\nTrial 2: 70.0 ms...\nTrial 4: 70.0 ms...\nTrial 3: 70.0 ms...\nTrial 1: 70.0 ms...\nTrial 2: 80.0 ms...\nTrial 4: 80.0 ms...\nTrial 3: 80.0 ms...\nTrial 1: 80.0 ms...\nTrial 2: 90.0 ms...\nTrial 4: 90.0 ms...\nTrial 3: 90.0 ms...\nTrial 1: 90.0 ms...\nTrial 2: 100.0 ms...\nTrial 4: 100.0 ms...\nTrial 3: 100.0 ms...\nTrial 1: 100.0 ms...\nTrial 2: 110.0 ms...\nTrial 4: 110.0 ms...\nTrial 3: 110.0 ms...\nTrial 1: 110.0 ms...\nTrial 2: 120.0 ms...\nTrial 4: 120.0 ms...\nTrial 3: 120.0 ms...\nTrial 1: 120.0 ms...\nTrial 2: 130.0 ms...\nTrial 4: 130.0 ms...\nTrial 3: 130.0 ms...\nTrial 1: 130.0 ms...\nTrial 4: 140.0 ms...\nTrial 2: 140.0 ms...\nTrial 3: 140.0 ms...\nTrial 1: 140.0 ms...\nTrial 4: 150.0 ms...\nTrial 2: 150.0 ms...\nTrial 3: 150.0 ms...\nTrial 1: 150.0 ms...\nTrial 2: 160.0 ms...\nTrial 4: 160.0 ms...\nTrial 3: 160.0 ms...\nTrial 1: 160.0 ms...\nTrial 4: 170.0 ms...\nTrial 2: 170.0 ms...\nTrial 3: 170.0 ms...\nTrial 1: 170.0 ms...\nTrial 4: 180.0 ms...\nTrial 2: 180.0 ms...\nTrial 3: 180.0 ms...\nTrial 1: 180.0 ms...\nTrial 4: 190.0 ms...\nTrial 2: 190.0 ms...\nTrial 3: 190.0 ms...\nTrial 1: 190.0 ms...\nTrial 4: 200.0 ms...\nTrial 2: 200.0 ms...\nTrial 3: 200.0 ms...\nTrial 1: 200.0 ms...\nBuilding the NEURON model\nBuilding the NEURON model\n[Done]\n[Done]\nTrial 6: 0.03 ms...\nTrial 5: 0.03 ms...\nTrial 6: 10.0 ms...\nTrial 5: 10.0 ms...\nTrial 6: 20.0 ms...\nTrial 5: 20.0 ms...\nTrial 6: 30.0 ms...\nTrial 5: 30.0 ms...\nTrial 6: 40.0 ms...\nTrial 5: 40.0 ms...\nTrial 6: 50.0 ms...\nTrial 5: 50.0 ms...\nTrial 6: 60.0 ms...\nTrial 5: 60.0 ms...\nTrial 6: 70.0 ms...\nTrial 5: 70.0 ms...\nTrial 6: 80.0 ms...\nTrial 5: 80.0 ms...\nTrial 6: 90.0 ms...\nTrial 5: 90.0 ms...\nTrial 6: 100.0 ms...\nTrial 5: 100.0 ms...\nTrial 6: 110.0 ms...\nTrial 5: 110.0 ms...\nTrial 6: 120.0 ms...\nTrial 5: 120.0 ms...\nTrial 6: 130.0 ms...\nTrial 5: 130.0 ms...\nTrial 6: 140.0 ms...\nTrial 5: 140.0 ms...\nTrial 6: 150.0 ms...\nTrial 5: 150.0 ms...\nTrial 6: 160.0 ms...\nTrial 5: 160.0 ms...\nTrial 6: 170.0 ms...\nTrial 5: 170.0 ms...\nTrial 6: 180.0 ms...\nTrial 5: 180.0 ms...\nTrial 6: 190.0 ms...\nTrial 5: 190.0 ms...\nTrial 6: 200.0 ms...\nTrial 5: 200.0 ms...\n\n    </div>\n</div>\n<div class='code-cell'>\n    <code class='language-python'>\n        plot_dipole(dpls, show=False)\nplt.show()\n    </code>\n</div>\n<div class='output-cell'><div class='output-label'>\n    Out:\n</div>\n    <div class='output-code'>\n        &lt;Figure size 640x480 with 1 Axes&gt;\n    </div>\n</div>\n<div class='output-cell'>\n    <img src='output_nb_parallelism_joblib_notebook/fig_01.png'/>\n</div>"
        }
    }
}