<html><body>
<div class='markdown-cell'>
	<h1>4.4: Animating HNN simulations</h1>
<p>This example demonstrates how to animate HNN simulations</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		# Author: Nick Tolley <nicholas_tolley@brown.edu>
	</code>
</div>
<div class='markdown-cell'>
	<p>First, we'll import the necessary modules for instantiating a network
and running a simulation that we would like to animate.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		import os.path as op

import matplotlib.pyplot as plt

import hnn_core
from hnn_core import jones_2009_model, simulate_dipole, read_params
from hnn_core.network_models import add_erp_drives_to_jones_model
	</code>
</div>
<div class='markdown-cell'>
	<p>We begin by instantiating the network. For this example, we will
reduce the number of cells in the network to speed up the
simulations.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		net = jones_2009_model(mesh_shape=(3, 3))

# Note that we move the cells further apart to allow better visualization of
# the network (default inplane_distance=1.0 Âµm).
net.set_cell_positions(inplane_distance=300)
	</code>
</div>
<div class='markdown-cell'>
	<p>The <a
href="https://jonescompneurolab.github.io/hnn-core/stable/generated/hnn_core.viz.NetworkPlotter.html#hnn_core.viz.NetworkPlotter">NetworkPlotter</a>
class can be used to visualize the 3D structure of the network.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		from hnn_core.viz import NetworkPlotter

net_plot = NetworkPlotter(net)
	</code>
</div>
<div class='output-cell'><div class='output-label'>
	Out:
</div>
	<div class='output-code'>
		&lt;Figure size 640x480 with 2 Axes&gt;
	</div>
</div>
<div class='output-cell'>
	<img src='output_nb_animating_hnn_simulations_notebook/fig_01.png'/>
</div>
<div class='markdown-cell'>
	<p>We can also visualize the network from another angle by adjusting the
azimuth and elevation parameters.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		net_plot.azim = 45
net_plot.elev = 40
net_plot.fig
	</code>
</div>
<div class='output-cell'><div class='output-label'>
	Out:
</div>
	<div class='output-code'>
		&lt;Figure size 640x480 with 2 Axes&gt;
	</div>
</div>
<div class='output-cell'>
	<img src='output_nb_animating_hnn_simulations_notebook/fig_02.png'/>
</div>
<div class='markdown-cell'>
	<p>Next we add event related potential (ERP) producing drives to the
network and run the simulation (see the <a
href="https://jonescompneurolab.github.io/textbook/content/05_erps/hnn_core.html">ERP
simulation</a> for more details). To visualize the membrane potential of
cells in the network, we need to pass
<code>record_vsec=&amp;#x27;all&amp;#x27;</code> to
<code>simulate_dipole(...)</code>, which turns on the recording of
voltages in all sections of all cells in the network.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		add_erp_drives_to_jones_model(net)
dpl = simulate_dipole(net, tstop=170, record_vsec='all')
net_plot = NetworkPlotter(net)  # Reinitialize plotter with simulated network
	</code>
</div>
<div class='output-cell'><div class='output-label'>
	Out:
</div>
	<div class='output-code'>
		Joblib will run 1 trial(s) in parallel by distributing trials over 1 jobs.
Loading custom mechanism files from /Users/austinsoplata/rep/brn/hnn-core/hnn_core/mod/arm64/.libs/libnrnmech.so
Building the NEURON model
[Done]
Trial 1: 0.03 ms...
Trial 1: 10.0 ms...
Trial 1: 20.0 ms...
Trial 1: 30.0 ms...
Trial 1: 40.0 ms...
Trial 1: 50.0 ms...
Trial 1: 60.0 ms...
Trial 1: 70.0 ms...
Trial 1: 80.0 ms...
Trial 1: 90.0 ms...
Trial 1: 100.0 ms...
Trial 1: 110.0 ms...
Trial 1: 120.0 ms...
Trial 1: 130.0 ms...
Trial 1: 140.0 ms...
Trial 1: 150.0 ms...
Trial 1: 160.0 ms...

		&lt;Figure size 640x480 with 2 Axes&gt;
	</div>
</div>
<div class='output-cell'>
	<img src='output_nb_animating_hnn_simulations_notebook/fig_03.png'/>
</div>
<div class='markdown-cell'>
	<p>Finally, we can animate the simulation using the
<code>export_movie()</code> method. We can adjust the xyz limits of the
plot to better visualize the network.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		# # If you want to save the animation to a file, then uncomment the code in this cell.
# net_plot.xlim = (400, 1600)
# net_plot.ylim = (400, 1600)
# net_plot.zlim = (-500, 1600)
# net_plot.azim = 225
# net_plot.export_movie('animation_demo.gif', dpi=100, fps=30, interval=100)
	</code>
</div>
</body></html>