<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNN Textbook</title>
    <!-- <base href="/website_redesign/"> -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>

	<div id="mySidebar" class="sidebar">
		<div class="navbar-header">
		<a>
			Human Neocortical Neurosolver
		</a>
		<br>
			<svg class="collapse-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
				<path d="M9 9H4v1h5V9z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/>
			</svg>
		</div>
		<a href="/website_redesign/content/preface.html">Preface</a>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				1. Getting Started
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/01_getting_started/challenge.html">1.1 Introducing HNN</a>
				<a href="/website_redesign/content/01_getting_started/template_model.html">1.2 Template Model</a>
				<a href="/website_redesign/content/01_getting_started/installation.html">1.3 Installation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				2. Background
			</a>
			<div class="submenu">
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				3. Model Assumptions
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/03_model_assumptions/cortical_column_structure.html">3.1 Cortical Column Structure</a>
				<a href="/website_redesign/content/03_model_assumptions/primary_electric_currents.html">3.2 Primary Electrical Currents</a>
				<a href="/website_redesign/content/03_model_assumptions/neurons_morphology_and_physiology.html">3.3 Neurons: Morphology and Physiology</a>
				<a href="/website_redesign/content/03_model_assumptions/synaptic_connectivity.html">3.4 Synaptic Connectivity</a>
				<a href="/website_redesign/content/03_model_assumptions/evoked_and_rhythmic_driving_inputs.html">3.5 Evoked and Rhythmic Driving Inputs</a>
				<a href="/website_redesign/content/03_model_assumptions/tonic_and_noisy_driving_inputs.html">3.6 Tonic and Noisy Driving Inputs</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				4. Using HNN
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/04_using_hnn/plot_firing_pattern.html">4.1 Plot Firing Pattern</a>
				<a href="/website_redesign/content/04_using_hnn/record_and_plot_extracellular_potentials.html">4.2 Record & Plot Extracellular Potentials</a>
				<a href="/website_redesign/content/04_using_hnn/modifying_local_connectivity.html">4.3 Modifying Local Connectivity</a>
				<a href="/website_redesign/content/04_using_hnn/animating_hnn_simulations.html">4.4 Animating HNN Simulations</a>
				<a href="/website_redesign/content/04_using_hnn/batch_simulation.html">4.5 Batch Simulation</a>
				<a href="/website_redesign/content/04_using_hnn/simulate_beta_modulated_erp.html">4.6 Simulate Beta-modulated ERP</a>
				<a href="/website_redesign/content/04_using_hnn/parallelism_joblib.html">4.7 Parallelism: Joblib</a>
				<a href="/website_redesign/content/04_using_hnn/parallelism_mpi.html">4.8 Parallelism: MPI</a>
				<a href="/website_redesign/content/04_using_hnn/optimize_simulated_evoked_response_parameters.html">4.9 Optimize simulated evoked response parameters</a>
				<a href="/website_redesign/content/04_using_hnn/optimize_simulated_rhythmic_response_parameters.html">4.10 Optimize simulated rhythmic response parameters</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				5. Simulating ERPs
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/05_erps/erps_in_gui.html">5.1 GUI Tutorial of ERPs Simulation</a>
				<a href="/website_redesign/content/05_erps/hnn_core.html">5.2 API Tutorial of ERPs Simulation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				6. Simulating Alpha/Beta Rhythms
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/06_alpha_beta/gui.html">6.1 GUI Tutorial of Alpha/Beta Rhythms</a>
				<a href="/website_redesign/content/06_alpha_beta/api.html">6.2 API Tutorial of Alpha/Beta Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				7. Simulating Gamma Rhythms
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/07_gamma/gamma_in_gui.html">7.1 GUI Tutorial of Gamma Rhythms</a>
				<a href="/website_redesign/content/07_gamma/gamma_in_api.html">7.2 API Tutorial of Gamma Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				8. From Data to Simulation
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/08_data_to_simulation/from_meg_to_hnn.html">8.1 From MEG sensor-space data to HNN simulation</a>
			</div>
		</div>
	<div style='height: 30px;'></div>
	</div>


    <div class="topbar">
        
        <!-- Topbar menu -->
        <div class="menu-container">
            <div class="menu-icons">
                <button class="openbtn" onclick="toggleNav()">
                    ☰
                </button>
                <a href="" class="home-link">
                    <div class="home-icon-container">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24" 
                            height="24"
                            viewBox="0 0 24 24" 
                            class="home-icon">
                            <path
                                d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"
                            />
                        </svg>
                    </div>
                </a>
                <button class="theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
                    </svg>
                </button>
                <div class="dropdown">
                    <button 
                        id="dropdownButton" 
                        class="dropdown-button">
                            <img
                                src="/website_redesign/content/assets/icons/fontsize.png"
                                alt="fontsize"
                            />
                    </button>
                    <div class="dropdown-content">
                        <button 
                            class="fontsize-btn" 
                            onclick="decreaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontminus.png"
                                alt="fontminus"
                            />
                        </button>
                        <button 
                            class="fontsize-btn" 
                            onclick="increaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontplus.png"
                                alt="fontplus"
                            />
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topbar image -->
        <div class="topbar-logo-container">
            <img 
                id="topbar-logo"
                src="https://hnn.brown.edu/wp-content/uploads/hnn-medium.png"
            />
        </div>

        <!-- Right side of topbar -->
        <div class="socials-container">
            <div class="social-icons">
                <a 
                    href="https://github.com/jonescompneurolab/hnn-core" 
                    target="_blank" 
                    aria-label="GitHub">
                    <img 
                        src="/website_redesign/content/assets/icons/github.png"
                        alt="GitHub">
                </a>
                <a 
                    href="https://bsky.app/profile/hnnsolver.bsky.social" 
                    target="_blank"
                    aria-label="BlueSky">
                    <img 
                        src="/website_redesign/content/assets/icons/bluesky.png"
                        alt="BlueSky">
                </a>
                <a 
                    href="https://www.linkedin.com/company/human-neocortical-neurosolver/" 
                    target="_blank"
                    aria-label="LinkedIn">
                    <img 
                        src="/website_redesign/content/assets/icons/linkedin.png"
                        alt="LinkedIn">
                </a>
            </div>
        </div>
    </div>

    <div id="main">
    <div id="content-wrapper">
    <div id="content">

<!--
# Title: 7.1 GUI Tutorial of Gamma Rhythms
# Updated: 2025-02-14
#
# Contributors:
    # Dylan Daniels
-->
<h1>7.1 GUI Tutorial of Gamma Rhythms</h1>
<h2>Tutorial Table of Contents</h2>
<ol type="1">
<li><p><a href="#toc-1">Background</a></p></li>
<li><p><a href="#toc-2">Downloading HNN Parameter Set Files</a></p></li>
<li><p><a href="#toc-3">Setting Initial Run Parameters</a></p></li>
<li><p><a href="#toc-4">Load/view Parameters of the Network
Structure</a></p></li>
<li><p><a href="#toc-5">Load/view Parameters of the External
Drive</a></p></li>
<li><p><a href="#toc-6">Run the Simulation and Visualize the Dipole and
Spectrogram</a></p></li>
<li><p><a href="#toc-7">Calculating and Viewing Spiking Activity and
Power Spectral Density (PSD)</a></p></li>
<li><p><a href="#toc-8">Adjusting parameters</a></p>
<ul>
<li><a href="#toc-8-1">8.1 Restricting Spiking to L5</a></li>
<li><a href="#toc-8-2">8.2 Increasing Cell Excitability via a Weak Tonic
Input</a></li>
<li><a href="#toc-8-3">8.3 Increasing Tonic Input</a></li>
<li><a href="#toc-8-4">8.4 Weakening the Excitatory Connections</a></li>
<li><a href="#toc-8-5">8.5 Removing the Inhibitory Connections</a></li>
<li><a href="#toc-8-6">8.6 Reducing the GABAA Decay Time</a></li>
<li><a href="#toc-8-7">8.7 Exercises for Further Exploration</a></li>
</ul></li>
<li><p><a href="#toc-9">“Strong” gamma can arise from tonic inputs to
pyramidal neurons</a></p></li>
<li><p><a href="#toc-10">Gamma Can Emerge from Rhythmic Subthreshold
Synaptic Inputs to Pyramidal Neurons</a></p>
<ul>
<li><a href="#toc-10-1">10.1 Adding Noise to Gamma Generated through
Rhythmic Subthreshold Synaptic Inputs</a></li>
<li><a href="#toc-10-2">10.2 Exercises for Further Exploration</a></li>
</ul></li>
<li><p><a href="#toc-11">Have Fun Exploring your Own Data!</a></p></li>
</ol>
<p><a id="toc-1"></a></p>
<h2>1. Background</h2>
<p>In order to understand the workflow and initial parameter sets
provided with this tutorial, we must first briefly describe prior
studies on the mechanistic origin of gamma rhythms, including our prior
modeling work that led to the creation of the parameter sets you will
work with <span class="citation"
data-cites="lee_distinguishing_2013">(<a
href="#ref-lee_distinguishing_2013" role="doc-biblioref">Lee and Jones
2013</a>)</span>.</p>
<p>Gamma rhythms can encompass a wide band of frequencies from 30-150
Hz. Here, we will focus on the generation of so called low gamma rhythms
in the 30-80 Hz range. It has been well established through experiments
and computational modeling that these rhythms can emerge in local
spiking networks through interactions of excitatory cell and inhibitory
cell interactions, with the period of the oscillation set by the time
constant of decay of GABAA-mediated inhibitory currents (<span
class="citation" data-cites="cardin_driving_2009">(<a
href="#ref-cardin_driving_2009" role="doc-biblioref">Cardin et al.
2009</a>)</span>, <span class="citation"
data-cites="vierling-claassen_computational_2010">(<a
href="#ref-vierling-claassen_computational_2010"
role="doc-biblioref">Vierling-Claassen et al. 2010</a>)</span>, <span
class="citation" data-cites="buzsaki_mechanisms_2012">(<a
href="#ref-buzsaki_mechanisms_2012" role="doc-biblioref">Buzsáki and
Wang 2012</a>)</span>), a mechanism that has been referred to as
pyramidal-interneuronal gamma (PING). In normal regimes, the decay time
constant of GABAA-mediated synapses (~25 ms) bounds oscillations to the
low gamma frequency band (~40 Hz).</p>
<p>In general, PING rhythms are initiated by “excitation” to the
excitatory (E) cells that causes spiking, which in turn synaptically
activates a spiking population of inhibitory (I) cells. In turn, these I
cells inhibit the E cells, preventing further E cell activity until the
E cells can overcome the effects of the inhibition (~25 ms later). The
pattern is repeated, creating a gamma frequency oscillation (~40 Hz, 40
spikes/second). This general principle is schematically described in
Figure 1 below. The frequency of the rhythm is paced by this time
constant of decay of inhibition, which is mediated by strong GABA-A
currents, as well as the excitability of the E cells (if the E cells are
very excitable, they can fire before the inhibition has completely worn
off, and the oscillation will be faster).</p>
<section class="stylefig">
<h3>Figure 1</h3>
<!-- was originally at ![](https://raw.githubusercontent.com/jonescompneurolab/hnn-tutorials/master/gamma/images/image19.png) -->
<img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_01.png" />
<p align="justify">
Schematic illustration of the circuit mechanisms underlying PING
rhythms.
</p>
</section>
<p>In this tutorial, we will explore the generation of PING rhythms in
the HNN model. We will provide example parameter files and walk through
simulations that generate gamma activity in both Layers 2/3 and Layer 5,
as in <span class="citation" data-cites="lee_distinguishing_2013">(<a
href="#ref-lee_distinguishing_2013" role="doc-biblioref">Lee and Jones
2013</a>)</span>. This tutorial relies on a different type of exogenous
drive to “activate” the local network than the other tutorials. Here,
the necessary excitation to generate spiking in the pyramidal neurons
that initiates the rhythm (see PING description above) is provided by a
continuous train of action potentials with a Poisson distribution that
activates post-synaptic excitatory AMPA synapses on the pyramidal
neurons. This Poisson drive causes the pyramidal neurons to fire,
dependent on the chosen conductance of the AMPA currents. The inhibition
in the network is strong enough to overcome the Poisson drive and
entrain the network spiking into a gamma frequency rhythm.</p>
<p>Of note, gamma rhythms can be generated by circuit mechanisms other
than PING, including subthreshold rhythmic exogenous drive. The
publication <span class="citation"
data-cites="lee_distinguishing_2013">(<a
href="#ref-lee_distinguishing_2013" role="doc-biblioref">Lee and Jones
2013</a>)</span> examined various mechanisms of generation of gamma
activity and described ways to distinguish the mechanisms of generation
based on features of current dipole signal. After completing this
tutorial, we encourage you to explore alternate mechanisms of gamma
generation and to compare to your own gamma data.</p>
<div class="callout callout-warning">
<table class="callout-table">
<tr>
<td class="emoji-cell">
<svg class="exclamation-icon" viewBox="0 0 16 16" width="20" height="20">
<path d="M15.35 12.81 9 2.08a1.22 1.22 0 0 0-2 0L.65 12.81a1.14 1.14 0 0 0 1 1.69h12.66a1.14 1.14 0 0 0 1.04-1.69zm-13.66.55L8 2.64l6.31 10.72z"/>
<path d="M7.32 5.45h1.25V10H7.32z"/>
<ellipse cx="7.95" cy="11.9" rx=".67" ry=".7"/>
</svg>
</td>
<td class="text-cell">
Please note that the configuration we use in this Tutorial is for
illustrative purposes only. Layer 2/3 and Layer 5 are not interconnected
in the simulations in this tutorial, therefore <em>the network used is
not biologically realistic</em>.
</td>
<td class="emoji-cell">
</td>
</tr>
</table>
</div>
<p><a id="toc-2"></a></p>
<h2>2. Downloading HNN Parameter Set Files</h2>
<p>Throughout this tutorial, we will be using several different HNN
parameter set files. These files are not included in the HNN
installation, but instead must be downloaded separately. The easiest way
to get them is to <a
href="https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Fjonescompneurolab%2Fhnn-data%2Ftree%2Fmain%2Fworkshops%2Fgamma_gui_walkthrough">click
this link, which will download a ZIP file that contains the four files
we need</a>. Alternatively, you can download (or <code>git clone</code>)
this Github repository: <a
href="https://github.com/jonescompneurolab/hnn-data">hnn-data</a> and
then access the files in the
<code>workshops/gamma_gui_walkthrough</code> directory. These four files
are named <code>gamma_L5weak_L2weak.json</code>,
<code>gamma_L5weak_only.json</code>,
<code>gamma_L5ping_L2ping.json</code>, and
<code>gamma_rhythmic_drive.json</code>.</p>
<p>Begin by starting the HNN GUI. See our <a
href="../01_getting_started/installation.html#google-colab">Installation
page</a> for instructions on either running HNN freely in the cloud or
installing it locally. If you are using the Google CoLab notebook or
NSG, follow the instructions for starting the GUI. If you are using a
local install of HNN, run the following command from a terminal:</p>
<pre><code>hnn-gui</code></pre>
<p><a id="toc-3"></a></p>
<h2>3. Setting Initial Run Parameters</h2>
<p><strong>Before</strong> running any simulations, we need to change
some default parameters of the simulations. Please note that if you
refresh the browser tab or restart HNN, you will have to re-enter all of
these parameter changes.</p>
<ol type="1">
<li>Change the <code>Name</code> of the simulation to
<code>gamma_L5weak_L2weak</code>.</li>
<li>Change <code>tstop (ms)</code> from <code>170</code> to
<code>300</code>.</li>
<li>Change <code>Dipole Smoothing</code> from <code>30</code> to
<code>0</code>. This is necessary so that higher-frequency signal
content like gamma can be detected and analyzed correctly.</li>
<li>Only if you are using Mac or Linux (not Windows), and only if you
installed HNN locally, then do the following (you may have already
obtained this number in the initial install):
<ol type="i">
<li>run the following command in a Terminal:
<code>python -c "import psutil ; print(psutil.cpu_count(logical=False)-1)"</code></li>
<li>read the output number,</li>
<li>put that number in the <code>Cores</code> textbox of the GUI. This
will greatly increase your simulation speed.</li>
</ol></li>
</ol>
<p><a id="toc-4"></a></p>
<h2>4. Load/view Parameters of the Network Structure</h2>
<ol type="1">
<li>Next, click on the <code>Network</code> tab.</li>
<li>Inside the tab, click the button
<code>Load local network connectivity (0)</code>, then select the file
<code>gamma_L5weak_L2weak.json</code>, which you downloaded previously
in <a href="#toc-2">Section 2</a>.</li>
</ol>
<p>The adjustable network parameters are displayed in the dropdown boxes
under the <code>Connectivity</code> tab, as shown in <a
href="#figure-2">Figure 2</a> below.</p>
<section class="stylefig">
<h3>Figure 2</h3>
<!-- Was originally at (note that 03 and 02 were swapped) ![](images/gamma_fig_03.png) -->
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_02.png" /></p>
</section>
<p>In our loaded configuration file, the strengths of synaptic
connections are significantly different than in the <a
href="../01_getting_started/template_model.html">HNN Template Model</a>
for the sake of simulating gamma oscillations. In addition to many
connection strengths being increased or decreased, all connections
<strong>between</strong> Layer 2/3 and Layer 5 have been turned off
(weight = 0
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">\mu S</annotation></semantics></math>).
Connections between excitatory cells within each layer are also turned
off. Additionally, note that the inhibitory conductances within layers
are stronger than the excitatory conductances, and that there are strong
inhibitory-to-inhibitory (i.e., basket-to-basket) connections. This
strong autonomous inhibition will cause synchrony among the basket
cells, and hence strong inhibition onto the pyramidal neurons.</p>
<div class="callout callout-warning">
<table class="callout-table">
<tr>
<td class="emoji-cell">
<svg class="exclamation-icon" viewBox="0 0 16 16" width="20" height="20">
<path d="M15.35 12.81 9 2.08a1.22 1.22 0 0 0-2 0L.65 12.81a1.14 1.14 0 0 0 1 1.69h12.66a1.14 1.14 0 0 0 1.04-1.69zm-13.66.55L8 2.64l6.31 10.72z"/>
<path d="M7.32 5.45h1.25V10H7.32z"/>
<ellipse cx="7.95" cy="11.9" rx=".67" ry=".7"/>
</svg>
</td>
<td class="text-cell">
Keep in mind that because Layer 2/3 and Layer 5 are not connected,
<em>this is not a biologically realistic network</em>. We use this
configuration as a starting point for illustrative purposes only, as it
will prevent pyramidal-to-pyramidal interactions from disrupting the
gamma rhythm.
</td>
<td class="emoji-cell">
</td>
</tr>
</table>
</div>
<p><a id="toc-5"></a></p>
<h2>5. Load/view Parameters of the External Drive</h2>
<ol type="1">
<li>Next, click the tab labeled: <code>External drives</code>.</li>
<li>Inside the tab, click the button
<code>Load external drives (0)</code>, then select the file
<code>gamma_L5weak_L2weak.json</code>, which you downloaded previously
in <a href="#toc-2">Section 2</a>. This is the same file you just
selected in <a href="#toc-4">Section 4</a>.</li>
<li>Click the dropdown menu labeled
<code>extpois (proximal)</code>.</li>
</ol>
<p>You should now see a dropdown menu which contains the adjustable
drive parameters, as shown in <a href="#figure-3">Figure 3</a> below.
These parameters control a Poisson process of excitatory (AMPAergic)
synaptic input spikes, which will be used to “activate” the network.
These driving inputs will be delivered to the somas of the pyramidal
neurons in Layer 2/3 (L2/3) and Layer 5 (L5). The inputs will generate
spiking activity in the pyramidal neurons, and this pyramidal activity
will initiate the PING rhythm.</p>
<section class="stylefig">
<h3>Figure 3</h3>
<!-- Was originally at (note that 03 and 02 were swapped) ![](images/gamma_fig_02.gif) -->
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_03.gif" /></p>
</section>
<p><a id="toc-6"></a></p>
<h2>6. Run the Simulation and Visualize the Dipole and Spectrogram</h2>
<p>Now that we have set our Simulation parameters and loaded in both our
network configuration and external drive, we are ready to run our
simulation. To do so, click the <code>Simulation</code> tab, then click
the <code>Run</code> button.</p>
<div class="callout callout-warning">
<table class="callout-table">
<tr>
<td class="emoji-cell">
<svg class="exclamation-icon" viewBox="0 0 16 16" width="20" height="20">
<path d="M15.35 12.81 9 2.08a1.22 1.22 0 0 0-2 0L.65 12.81a1.14 1.14 0 0 0 1 1.69h12.66a1.14 1.14 0 0 0 1.04-1.69zm-13.66.55L8 2.64l6.31 10.72z"/>
<path d="M7.32 5.45h1.25V10H7.32z"/>
<ellipse cx="7.95" cy="11.9" rx=".67" ry=".7"/>
</svg>
</td>
<td class="text-cell">
Note that each new simulation you run will require a unique simulation
<code>Name</code> as indicated in the <code>Simulation</code> tab. If
you have run a simulation under the same name previously, you will get
an error message stating that the simulation has failed.
</td>
<td class="emoji-cell">
</td>
</tr>
</table>
</div>
<p>The console below the <code>Run</code> button will print progress as
the simulation is running. Once it is complete, the input histogram and
the dipole will be plotted in the right-most panel, as shown in <a
href="#figure-4">Figure 4</a> below.</p>
<section class="stylefig">
<h3>Figure 4</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_04.png" /></p>
</section>
<p>A histogram displaying the Poisson drive to the excitatory cells is
shown in the top panel, displaying no clear rhythmicity. However, in the
simulated dipole below it, there <em>is</em> some obvious rhythmicity in
the signal!</p>
<p>The Poisson drive provided causes pyramidal neurons to fire, which in
turn cause the inhibitory neurons to fire. Feedback inhibition from the
interneurons to the pyramidal neurons generates a regular gamma rhythm
via the PING mechanism described above (see <a href="#toc-1">Section 1.
Background</a>), which we can see in the rhythmicity of the simulated
dipole. The sharp downward deflections in the dipole are reflective of
the strong inhibition onto the pyramidal neuron somas, which pulls
current flow down the dendrites.</p>
<p>To confirm that the rhythmicity is in the gamma frequency range,
let’s plot a spectrogram of the net current dipole. Do the
following:</p>
<ol type="1">
<li>Click the <code>Visualization</code> tab.</li>
<li>Click the <code>Layout template</code> dropdown menu, then select
the <code>Dipole-Spectrogram (2x1)</code> option.</li>
<li>Click the <code>Dataset</code> dropdown, then make sure the correct
simulation (<code>gamma_L5weak_L2weak</code>) is selected. Note that
when plotting future simulations, you always need to change this.</li>
<li>Click the <code>Make Figure</code> button. This will produce a
spectrogram that resembles <a href="#figure-5">Figure 5</a> below.</li>
</ol>
<section class="stylefig">
<h3>Figure 5</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_05.png" /></p>
</section>
<p>The spectrogram confirms that, for this network and drive
configuration, the dipole signal contains spectral content in the gamma
range (~55 Hz).</p>
<p><a id="toc-7"></a></p>
<h2>7. Calculating and Viewing Spiking Activity and Power Spectral
Density (PSD)</h2>
<p>We can make a new figure to view the spiking activity generated by
the different neuron populations in the network.</p>
<ol type="1">
<li>Click the <code>Layout template</code> dropdown menu again, but this
time, select the <code>Drive-Spikes (2x1)</code> option.</li>
<li>Click the <code>Dataset</code> dropdown, then make sure the correct
simulation (<code>gamma_L5weak_L2weak</code>) is selected. Note that
when plotting future simulations, you always need to change this.</li>
<li>Click the <code>Make Figure</code> button. This will produce a
rastergram like in <a href="#figure-6">Figure 6</a> below.</li>
</ol>
<section class="stylefig">
<h3>Figure 6</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_06.png" /></p>
</section>
<p>Notice that the excitatory pyramidal neurons in each layer (orange
and red dots / lines) fire before the inhibitory basket cells in each
layer (blue and green dots / lines). The pyramidal neuron firing drives
the basket cells to fire. The basket cells are highly synchronous due to
the strong inhibitory-to-inhibitory connections. The basket cells then
prevent the pyramidal neurons from firing for ~25 ms, generating the
PING rhythms. The pyramidal neurons are firing periodically, but with
lower synchrony due to the Poisson drive, which creates randomized spike
times across the populations (once the inhibition sufficiently wears
off). This type of dispersed pyramidal neuron firing is considered
<strong>“weak” PING</strong> - hence the configuration file name
including “weak” in the name.</p>
<p>We can also confirm that this oscillation is in the gamma frequency
range by viewing the power spectral density of the current dipole signal
(average spectrogram across time). To view the PSD from this simulation,
do the following:</p>
<ol type="1">
<li>Click the <code>Layout template</code> dropdown menu again, but this
time, select the <code>PSD Layers (3x1)</code> option.</li>
<li>Click the <code>Dataset</code> dropdown, then make sure the correct
simulation (<code>gamma_L5weak_L2weak</code>) is selected. Note that
when plotting future simulations, you always need to change this.</li>
<li>Click the <code>Make Figure</code> button. This will produce a plot
like in <a href="#figure-7">Figure 7</a> below.</li>
</ol>
<section class="stylefig">
<h3>Figure 7</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_07.png" /></p>
</section>
<p>Notice that the power in the gamma band is much smaller in Layer 2/3
than in Layer 5 (pay attention to the scale of the y-axes). This is
reflective, in part, of the fact that the length of the Layer 2/3
pyramidal neurons is smaller than Layer 5. Hence, Layer 2/3 cells
produce smaller current dipole moments that can be masked by activity in
Layer 5 (see <span class="citation"
data-cites="lee_distinguishing_2013">(<a
href="#ref-lee_distinguishing_2013" role="doc-biblioref">Lee and Jones
2013</a>)</span> for further discussion).</p>
<p><a id="toc-8"></a></p>
<h2>8. Adjusting Parameters</h2>
<p>In the following sections, we explore the impacts of two key
parameters controlling gamma rhythmicity: <strong>cell
excitability</strong> and <strong>network connectivity</strong>. Cell
excitability can be adjusted in many ways, including changes to the
intrinsic properties of a neuron (e.g. membrane resting potential) or
the influence of external factors such as, for example, noisy background
inputs or neuromodulation. Network connectivity can be adjusted by
changing parameters such as the synaptic connection strengths between
cells or the time constants of synaptic activation.</p>
<p><a id="toc-8-1"></a></p>
<h3>8.1 Restricting Spiking to L5</h3>
<p>First, in order to simplify our investigation, we will load a network
configuration that retains connectivity ONLY in Layer 5 (all inputs and
connectivity in Layer 2/3 will become zero). Do the following:</p>
<ol type="1">
<li>Click on the <code>Network</code> tab.</li>
<li>Click the button <code>Load local network connectivity (0)</code>,
then select the file <code>gamma_L5weak_only.json</code>, which you
downloaded previously in <a href="#toc-2">Section 2</a>.</li>
<li>Click the <code>External drives</code> tab.</li>
<li>Click the button <code>Load external drives (0)</code>, then select
the file <code>gamma_L5weak_only.json</code>. This is the same file that
you just selected in step 2.</li>
<li>Click the <code>Simulation</code> tab and change the
<code>Name</code> to reflect the fact that we will be running a new
simulation. We’ll use the name <code>gamma_L5weak_only</code>.</li>
<li>Click <code>Run</code>.</li>
</ol>
<p>The simulation will yield a gamma rhythm that looks similar to the
one we observed previously, as shown in <a href="#figure-8">Figure 8</a>
below.</p>
<section class="stylefig">
<h3>Figure 8</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_08.png" /></p>
</section>
<p>However, if you create new <code>Drive-Spikes (2x1)</code> and
<code>PSD Layers (3x1)</code> plots for this new simulation, you will
see activity from <strong>only</strong> Layer 5. You can do this by
reproducing the steps for the plots described in <a
href="#toc-7">Section 7</a> above, but making sure you change
<code>Dataset</code> to the newer simulation
<code>gamma_L5weak_only</code>. You should see plots similar to those
shown below in <a href="#figure-9-a">Figure 9.A</a> and <a
href="#figure-9-b">Figure 9.B</a>.</p>
<section class="stylefig">
<h3>Figure 9-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_09_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 9-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_09_B.png" /></p>
</section>
<p>Notice the weak PING rhythm in Layer 5 consisting of weakly
synchronous pyramidal neuron firing, followed by synchronous inhibitory
neuron firing. The synchronous inhibitory spiking gates the network
dipole rhythm to ~55 Hz.</p>
<p><a id="toc-8-2"></a></p>
<h3>8.2 Increasing Cell Excitability via a Weak Tonic Input</h3>
<p>To examine the impact of <strong>cell excitability</strong> on gamma
expression, we can increase the excitability of the Layer 5 pyramidal
neurons by adding a “tonic applied current”. Biologically, this could
represent a change in neuromodulatory influence on the network. Do the
following:</p>
<ol type="1">
<li>Click the <code>External drives</code> tab.</li>
<li>Click the <code>Drive type</code> dropdown, and select the
<code>Tonic</code> option.</li>
<li>Click the <code>Add drive</code> button.</li>
<li>You should now see a new drive called <code>Tonic1</code>, in
addition to the previous <code>extpois (proximal)</code> drive.</li>
<li>Select the new drive, and change the <code>Amplitude (nA)</code>
going to the <code>L5_pyramidal</code> celltype to <code>2</code>. This
will set the amplitude of the tonic drive going to Layer 5 pyramidal
cells to be 2 nA.</li>
</ol>
<p>Your <code>External drives</code> tab should look similar to <a
href="#figure-10">Figure 10</a> below.</p>
<section class="stylefig">
<h3>Figure 10</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_10.png" /></p>
</section>
<p>After adding the tonic drive, we will run a new simulation. Do the
following:</p>
<ol type="1">
<li>Click the <code>Simulation</code> tab and change the
<code>Name</code> to <code>gamma_L5weak_tonic_01</code>.</li>
<li>Click the <code>Run</code> button.</li>
</ol>
<p>The simulation will yield the output shown in <a
href="#figure-11-a">Figure 11-A</a> below. Use the steps described
previously in <a href="#toc-6">Section 6</a> and <a
href="#toc-7">Section 7</a> to also make <a href="#figure-11-b">Figure
11-B</a> and <a href="#figure-11-c">Figure 11-C</a> below.</p>
<section class="stylefig">
<h3>Figure 11-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_11_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 11-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_11_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 11-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_11_C.png" /></p>
</section>
<p>Note that network takes longer to stabilize due to the initial impact
of the tonic current. From about 50 ms onward, we see that the initial
impact of the tonic input has subsided and the influence of both the
tonic and Poisson drives is more evident.</p>
<p><a href="#figure-11-b">Figure 11-B</a> shows the spike plot from the
latest simulation (<code>gamma_L5weak_tonic_01</code>), and you should
compare it to <a href="#figure-9-a">Figure 9-A</a>, which shows the same
simulation except for the new tonic drive
(<code>gamma_L5weak_only</code>). We see that by introducing a weak
tonic input, the pyramidal neuron spiking is visibly more synchronous,
though with some noise still present from the Poisson drive. We can also
see that there is an overall increase in the amount of spikes in the
later simulation when tonic input is included.</p>
<p>Similarly, if we compare <a href="#figure-11-c">Figure 11-C</a> to
the previous network (i.e. lacking the tonic input) using <a
href="#figure-9-b">Figure 9-B</a>, we observe that after the network
stabilizes, the frequency of gamma appears to have decreased slightly,
from approximately ~55 Hz to ~48 Hz.</p>
<p>We see that while increasing the excitability causes the pyramidal
cells to fire more synchronously, interpreting the competing effects of
the excitation and inhibition is not always straightforward. The more
synchronous pyramidal neuron firing is not strong enough to induce a
“strong” PING in the local network, as there is still some apparent
noise from the Poisson input. However, the overall
<strong>increase</strong> in the pyramidal neuron firing rate appears to
more strongly recruit the inhibitory interneurons, which has the net
effect of slightly <strong>decreasing</strong> the frequency of the
observed gamma rhythm.</p>
<p><a id="toc-8-3"></a></p>
<h3>8.3 Increasing Tonic Input</h3>
<p>Next, let’s continue examining the role of cell excitability on the
gamma by further increasing the tonic drive we added. Do the
following:</p>
<ol type="1">
<li>Click the <code>External drives</code> tab.</li>
<li>Select the <code>Tonic1</code> drive you recently added, and
increase the <code>Amplitude (nA)</code> going to the
<code>L5_pyramidal</code> celltype from <code>2</code> to
<code>6</code>.</li>
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the simulation <code>Name</code> to
<code>gamma_L5weak_tonic_02</code>.</li>
<li>Click <code>Run</code>.</li>
</ol>
<p>This will produce a simulation figure similar to <a
href="#figure-12-a">Figure 12-A</a> below. Like before, you should also
create new <code>Drive-Spikes (2x1)</code> and
<code>PSD Layers (3x1)</code> plots for the latest simulation; these
should resemble <a href="#figure-12-b">Figure 12-B</a> and <a
href="#figure-12-c">Figure 12-C</a>, respectively.</p>
<section class="stylefig">
<h3>Figure 12-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_12_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 12-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_12_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 12-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_12_C.png" /></p>
</section>
<p>Compared to the prior <code>gamma_L5weak_tonic_01</code> simulation,
this new <code>gamma_L5weak_tonic_02</code> simulation is
<em>significantly</em> more synchronous, which you can see especially
when comparing <a href="#figure-12-b">Figure 12-B</a> to <a
href="#figure-11-b">Figure 11-B</a>. However, for the same reason as
before (more pyramidal firing causing greater recruitment of inhibitory
neurons), the frequency of <code>gamma_L5weak_tonic_02</code> is even
lower than the previous simulation, decreasing slightly from
approximately ~48 Hz to ~44 Hz.</p>
<p><a id="toc-8-4"></a></p>
<h3>8.4 Weakening the Excitatory Connections</h3>
<p>We’ll now explore the impact of adjusting <strong>synaptic
connectivity</strong> parameters in the network. Do the following:</p>
<ol type="1">
<li>Click the <code>Network</code> tab.</li>
<li>Click the <code>Connectivity</code> sub-tab.</li>
<li>Scroll down the list of connections, and click on the
<code>L5_pyramidal-&gt;L5_basket (soma)</code> connection.</li>
<li>Decrease the AMPA <code>Weight</code> by a factor of 10, from
<code>0.00091</code> to <code>0.000091</code>.</li>
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> of the simulation to
<code>gamma_L5weak_tonic_03</code>.</li>
<li>Click <code>Run</code>.</li>
</ol>
<p>As we’ve done in previous sections, you’ll want to generate
additional visualizations that show the spike plot and the spectrogram.
The three typical figures we’ve been using are shown below.</p>
<section class="stylefig">
<h3>Figure 13-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_13_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 13-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_13_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 13-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_13_C.png" /></p>
</section>
<p>You may be thinking something like <em>“The last several simulations
gradually increased pyramidal firing, which caused increased inhibitory
cell firing, which then caused the frequency to go down. If we’re
weakening the E-to-I connection in this simulation, then the frequency
should increase.”</em> However! Part of what makes science interesting
is the unexpected and counter-intuitive. In <a
href="#figure-13-c">Figure 13-C</a>, you can clearly see that the gamma
rhythm has continued to <strong>decrease</strong>, from ~44 Hz to ~40
Hz. This slowing is still due to the fact that the
excitatory-to-inhibitory connection was greatly weakened. It now takes
longer for the basket cells to respond to the excitation: notice how
there there is an increase in the “lag” in the response of the
inhibitory cells (green) in <a href="#figure-13-b">Figure 13-B</a> which
is longer than in the earlier simulation <a href="#figure-12-b">Figure
12-B</a>.</p>
<p><a id="toc-8-5"></a></p>
<h3>8.5 Removing the Inhibitory Connections</h3>
<p>Next, we’ll explore the importance of the inhibitory connections in
setting gamma rhythmicity more directly.</p>
<ol type="1">
<li>Click the <code>Network</code> tab.</li>
<li>Click the the <code>Connectivity</code> sub-tab.</li>
<li>Scroll down to the same
<code>L5_pyramidal-&gt;L5_basket (soma)</code> connection you changed
earlier, and change the value back to what it was, from
<code>0.000091</code> to <code>0.00091</code>.</li>
<li>Click the <code>External drives</code> tab.</li>
<li>Select the <code>Tonic1</code> drive.</li>
<li>In the window of the <code>Tonic1</code> drive, click the red
<code>X Delete</code> button to remove the drive.</li>
</ol>
<p>The network in our GUI is now in the same state that it was
previously, when we simulated the Layer 5 weak PING configuration
(<code>gamma_L5weak_only</code>).</p>
<p>Next, let’s experiment with removing the inhibitory-to-inhibitory
connections. Do the following:</p>
<ol type="1">
<li>Click the <code>Network</code> tab.</li>
<li>Click the <code>Connectivity</code> sub-tab.</li>
<li>Remove the <code>L5_basket-&gt;L5_basket (soma)</code> connection by
decreasing its
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>A</mi><mi>B</mi><msub><mi>A</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">GABA_A</annotation></semantics></math>
<code>Weight</code> from <code>0.0075</code> to <code>0</code>.</li>
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> to
<code>gamma_L5weak_only_noinh</code>.</li>
<li>Click the <code>Run</code> button.</li>
<li>Similar to before, create the additional visualizations.</li>
</ol>
<section class="stylefig">
<h3>Figure 14-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_14_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 14-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_14_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 14-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_14_C.png" /></p>
</section>
<p>Notice that the rhythm is still present but is much less regular and
much more noisy (compare <a href="#figure-14-a">Figure 14-A</a> to <a
href="#figure-8">Figure 8</a>). You can also observe this in the spiking
activity by comparing <a href="#figure-14-b">Figure 14-B</a> to <a
href="#figure-9-a">Figure 9-A</a>. This lack of regularity is due to the
fact that removal of the inhibitory-to-inhibitory connections causes the
inhibition to be less synchronous and noisier. This causes the overall
PING rhythm to become noisier itself.</p>
<p>Indeed, if we plot the spectrogram of this simulation without the
inhibitory-to-inhibitory connections, we can see that the gamma
oscillation itself becomes unstable and gradually changes in
frequency:</p>
<section class="stylefig">
<h3>Figure 15</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_15.png" /></p>
</section>
<p><a id="toc-8-6"></a></p>
<h3>8.6 Reducing the GABAA Decay Time</h3>
<p>Lastly, we’ll show that the time constant of inhibitory decay is an
essential parameter controlling the frequency of the PING rhythm. Do the
following:</p>
<ol type="1">
<li>Click the <code>Network</code> tab.</li>
<li>Click the <code>Connectivity</code> sub-tab.</li>
<li>Restore the <code>L5_basket-&gt;L5_basket (soma)</code> connection
to its original value by by increasing its
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>A</mi><mi>B</mi><msub><mi>A</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">GABA_A</annotation></semantics></math>
<code>Weight</code> from <code>0</code> to <code>0.0075</code>.</li>
<li>Click the <code>Cell parameters</code> sub-tab.</li>
<li>Set the <code>Cell type</code> to <code>L5 Pyramidal</code>.</li>
<li>Set the <code>Cell Properties</code> to <code>Synapses</code>.</li>
<li>Decrease the <code>GABAA decay time (ms)</code> from <code>5</code>
to <code>2</code>, as shown in <a href="#figure-16">Figure 16</a>
below.</li>
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> to
<code>gamma_L5weak_only_fasterinh</code>.</li>
<li>Click the <code>Run</code> button.</li>
<li>Similar to before, create the additional visualizations.</li>
</ol>
<section class="stylefig">
<h3>Figure 16</h3>
<!-- Was originally figure 15 -->
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_16.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 17-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_17_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 17-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_17_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 17-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_17_C.png" /></p>
</section>
<p>Notice that the rhythm is now faster at ~60 Hz (compare <a
href="#figure-17-c">Figure 17-C</a> to <a href="#figure-9-b">Figure
9-B</a>). As illustrated in the spiking activity, the faster decay of
inhibition allows the pyramidal neurons to recover more quickly from the
inhibition and respond to the Poisson drive, resulting in a faster
network oscillation (compare <a href="#figure-17-b">Figure 17-B</a> to
<a href="#figure-9-a">Figure 9-A</a>).</p>
<p><a id="toc-8-7"></a></p>
<h3>8.7 Exercises for Further Exploration</h3>
<ul>
<li><p>How else might the excitability of the cells be adjusted? What
happens to the network dynamics? Can you make the oscillation faster or
slower?</p></li>
<li><p>How else might the synaptic connections in the network be
adjusted to impact gamma? What happens to the network dynamics? Can you
make the oscillation faster or slower?</p></li>
<li><p>Gamma rhythms can be created in neworks where the pyramidal
neurons do not fire on their own but their activity is still regulated
by interneuron firing (interneuron mediated gamma: ING). Can you adjust
parameters to create such an oscillation in the network?</p></li>
</ul>
<p><a id="toc-9"></a></p>
<h3>9. “Strong” Gamma Can Arise from Tonic Inputs to Pyramidal
Neurons</h3>
<div class="callout callout-warning">
<table class="callout-table">
<tr>
<td class="emoji-cell">
<svg class="exclamation-icon" viewBox="0 0 16 16" width="20" height="20">
<path d="M15.35 12.81 9 2.08a1.22 1.22 0 0 0-2 0L.65 12.81a1.14 1.14 0 0 0 1 1.69h12.66a1.14 1.14 0 0 0 1.04-1.69zm-13.66.55L8 2.64l6.31 10.72z"/>
<path d="M7.32 5.45h1.25V10H7.32z"/>
<ellipse cx="7.95" cy="11.9" rx=".67" ry=".7"/>
</svg>
</td>
<td class="text-cell">
Keep in mind that Layer 2/3 and Layer 5 are not synaptically connected
to each other in this simulation, or any other in this Tutorial.
</td>
<td class="emoji-cell">
</td>
</tr>
</table>
</div>
<p>The next exercise involves setting up a PING rhythm in both Layer 2/3
and Layer 5 by providing only <em>tonic</em> inputs to the pyramidal
neurons, as opposed to the stochastic <em>Poisson</em> inputs (or
Poisson + tonic inputs) described above. To do so, we will apply a
constant depolarizing current injection to the soma of neurons,
representative of a “tonic input”. Do the following:</p>
<ol type="1">
<li>Click on the <code>Network</code> tab.</li>
<li>Click the button <code>Load local network connectivity (0)</code>,
then select the file <code>gamma_L5ping_L2ping.json</code>, which you
downloaded previously in <a href="#toc-2">Section 2</a>.</li>
<li>Click the <code>External drives</code> tab.</li>
<li>Click the button <code>Load external drives (0)</code>, then select
the file <code>gamma_L5ping_L2ping.json</code>. This is the same file
that you just selected in step 2.</li>
</ol>
<p>Next, we will add a tonic input to the pyramidal neurons in Layer 2/3
and Layer 5. This input will generate spiking that initiates PING.</p>
<ol type="1">
<li>Click the <code>External drives</code> tab.</li>
<li>Click the <code>Drive type</code> dropdown, and select the
<code>Tonic</code> option.</li>
<li>Click the <code>Add drive</code> button.</li>
<li>You should now see a new drive called <code>Tonic0</code>.</li>
<li>Select the new drive, and increase the <code>Amplitude (nA)</code>
going to the <code>L2_pyramidal</code> celltype to <code>4</code>.</li>
<li>Increase the <code>Amplitude (nA)</code> going to the
<code>L5_pyramidal</code> celltype to <code>6</code>.</li>
<li>Make sure you do <strong>not</strong> increase the amplitude for any
inhibitory cells (such as <code>L2_basket</code> or
<code>L5_basket</code>).</li>
</ol>
<p>Your <code>External drives</code> tab should look like <a
href="#figure-18">Figure 18</a> below.</p>
<section class="stylefig">
<h3>Figure 18</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_18.png" /></p>
</section>
<p>Finally, let’s run the simulation:</p>
<ol type="1">
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> to
<code>gamma_L5ping_L2ping</code>.</li>
<li>Click <code>Run</code>.</li>
<li>Repeat the additional visualizations from earlier sections,
including generating the spectrogram.</li>
</ol>
<section class="stylefig">
<h3>Figure 19-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_19_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 19-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_19_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 19-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_19_C.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 19-D</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_19_D.png" /></p>
</section>
<p>In this simulation, there are no spiking inputs provided to the
model; instead, a current clamp provides a constant depolarizing current
to the pyramidal neuron somas, causing the cells to fire. This firing
initiates the PING rhythm through mechanisms similar to that described
above. In contrast to the Poisson drive, the constant depolarization to
pyramidal neurons creates higher excitability in the pyramidal neurons,
causing more synchronous firing. In turn, this causes the interneurons
to fire synchronously, producing a higher amplitude gamma
oscillation.</p>
<p>In <a href="#figure-19-a">Figure 19-A</a> above we see that the
dipole displays sharp downward deflections (compare to the “weak” PING
in <a href="#figure-4">Figure 4</a>). This is caused by the strong
synchronous inhibition onto the pyramidal neuron somas, which pulls
current flow down the dendrites. This PING rhythm has less variability
(compare <a href="#figure-19-b">Figure 19-B</a> to <a
href="#figure-9-a">Figure 9-A</a>) and would thus be considered “strong”
PING rather than “weak” PING.</p>
<p>When looked at together, the PSD (<a href="#figure-19-C">Figure
19-C</a>) and the spectrogram (<a href="#figure-19-d">Figure 19-D</a>)
illustrate that the dipole signal contains strong oscillatory components
in the gamma range (approximately ~45 Hz) in the net dipole, which is
being driven by the strong Layer 5 activity. Layer 2/3 is oscillating at
higher frequency with a lower amplitude (note the scaling of the y-axes
in <a href="#figure-19-C">Figure 19-C</a>).</p>
<p>The higher-frequency activity in Layer 5 (approximately ~85 Hz) comes
from the sharp deflections in the dipole waveform along with their
small-amplitude peak. Together, these parts of the signal create high
power at ~85 Hz in the frequency domain. These deflections are driven by
the strong depolarizing current on the pyramidal neurons, which causes
their voltage to rise quickly, even before the inhibitory neurons
fire.</p>
<p>A closer look at the spiking activity in <a
href="#figure-19-b">Figure 19-B</a> will reveal the mechanisms creating
these waveform shapes. The PING mechanism is seen in each layer where
the pyramidal neurons fire, causing the inhibitory neurons to fire,
which consequently stop the pyramidal neurons from firing until their
excitation outweighs the inhibition. Notice that the firing rate of
Layer 2/3 pyramidal and basket neurons is faster than that of Layer 5
neurons. This is because, although the Layer 2/3 pyramidal neurons
receive a lower current injection, they have shorter dendrites, and
therefore the current flow up and down the dendrites is faster. Further,
the Layer 2/3 pyramidal neurons have lower spiking thresholds due to
their intrinsic properties. In each layer, the inhibitory neurons are
firing synchronously and causing strong somatic inhibition on the
pyramidal neurons, resulting in fast downward current flow that creates
the sharp dipole deflections seen in the dipole waveforms above.</p>
<p>As an exercise, play with the current injection amplitude provided to
the different neurons to see how it affects the generated rhythm.</p>
<p><a id="toc-10"></a></p>
<h3>10. Gamma Can Emerge from Rhythmic Subthreshold Synaptic Inputs to
Pyramidal Neurons</h3>
<p>In the next example, we will apply 50 Hz rhythmic synaptic inputs
through proximal and distal projection patterns to produce gamma
oscillations similar to those shown in Figure 8A of <span
class="citation" data-cites="lee_distinguishing_2013">(<a
href="#ref-lee_distinguishing_2013" role="doc-biblioref">Lee and Jones
2013</a>)</span>, shown here:</p>
<div class="stylefig">
<figure>
<img
src="https://www.frontiersin.org/files/Articles/68869/fnhum-07-00869-HTML/image_m/fnhum-07-00869-g008.jpg"
alt="Figure 8A of Lee and Jones 2013" />
<figcaption aria-hidden="true">Figure 8A of Lee and Jones
2013</figcaption>
</figure>
</div>
<p>In this simulation, the strength of the input is set so that the
cells remain subthreshold, while gamma rhythms emerge from subthreshold
current flow in the pyramidal neuron dendrites. This is different from
how the PING mechanisms described above are generated from local spiking
interactions. Do the following:</p>
<ol type="1">
<li>Click the <code>Simulation</code> tab.</li>
<li>Increase the simulation <code>tstop</code> to <code>550</code>.</li>
<li>Click on the <code>Network</code> tab.</li>
<li>Click the button <code>Load local network connectivity (0)</code>,
then select the file <code>gamma_rhythmic_drive.json</code>, which you
downloaded previously in <a href="#toc-2">Section 2</a>.</li>
<li>Click the <code>External drives</code> tab.</li>
<li>Click the button <code>Load external drives (0)</code>, then select
the file <code>gamma_rhythmic_drive.json</code>. This is the same file
that you just selected in step 2.</li>
<li>You will see two drives named <code>bursty1 (proximal)</code> and
<code>bursty2 (distal)</code>. Click on and explore the parameters of
either.</li>
</ol>
<p>In this example, the pyramidal neurons receive inputs, and the
interneurons do not. The proximal and distal inputs start at 50.0 and
55.0 ms, respectively, and are slightly out of phase. This phase
mis-alignment allows synaptic inputs to effectively push current flow up
the dendrites, followed 5 ms later by current flow down the dendrites.
Additionally, the input frequency (as indicated by the
<code>Burst rate (Hz)</code> parameter) for both proximal and distal
inputs is set to 50 Hz, representing “bursts” of excitatory synaptic
input. The driving burst has an inter-burst-interval of 20 ms (equal to
<code>1/(50 Hz)</code>), with minimal noise within each driving burst
(as indicated by the <code>Burst std dev (Hz)</code> of 2.5 Hz). For a
detailed description of the driving bursts, please review the <a
href="../06_alpha_beta/gui.html">Alpha/Beta Tutorial found here</a>.</p>
<p>Note also that the amplitude of the inputs, which are <strong>only
provided to the Layer 5 pyramidal neurons</strong>, is set to a small
value of <code>0.00004</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">\mu S</annotation></semantics></math>,
which produces only subthreshold responses. As a result, the gamma
mechanism shown in this simulation is fundamentally different from the
previous examples, since it does not rely on the local spiking
interactions that underlie the PING mechanism.</p>
<p>Let’s run our simulation by doing the following:</p>
<ol type="1">
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> to
<code>gamma_rhythmic_drive</code>.</li>
<li>Click <code>Run</code>.</li>
<li>As before, make the additional visualizations.</li>
</ol>
<section class="stylefig">
<h3>Figure 20-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_20_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 20-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_20_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 20-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_20_C.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 20-D</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_20_D.png" /></p>
</section>
<p>The net dipole signal in this simulation, shown in <a
href="#figure-20-a">Figure 20-A</a> and elsewhere, shows a clear gamma
rhythm at ~50 Hz, produced by the Layer 5 pyramidal neurons. In <a
href="#figure-20-b">Figure 20-B</a>, our spike rastergram is completely
empty unlike before, because these are <em>sub-threshold</em>
oscillations. Note that here, the Layer 2/3 pyramidal neurons are not
receiving any drive, and therefore do not contribute to the dipole
current (visible in <a href="#figure-20-c">Figure 20-C</a>). There is
only minor stochasticity to the synaptic inputs (recall that
<code>Burst std dev (Hz)</code> is 2.5). Also note that the waveform
shape in this simulation is distinct from the previous examples in both
the total magnitude of the dipole moment and in the lack of sharp
deflections (which, previously, were produced by neuronal firing and
strong somatic inhibition during PING).</p>
<p><a id="toc-10-1"></a></p>
<h3>10.1 Adding Noise to Gamma Generated through Rhythmic Subthreshold
Synaptic Inputs</h3>
<p>In the final simulation of this section, we will add more noise to
the previously applied 50 Hz rhythmic drive. Do the following:</p>
<ol type="1">
<li>Click the <code>External drives</code> tab.</li>
<li>For each of the two drives, change the value of the
<code>Burst std dev (Hz)</code> from <code>2.5</code> to <code>5</code>.
This increase adds variability to the timing of the burst of synaptic
drive each input provides, and hence adds more “noise” to the
network.</li>
<li>Click the <code>Simulation</code> tab.</li>
<li>Change the <code>Name</code> to
<code>gamma_rhythmic_more_noise</code>.</li>
<li>Click <code>Run</code>.</li>
<li>As before, make the additional visualizations (we will skip making a
<code>Drive-Spikes (2x1)</code> plot due to the lack of spikes).</li>
</ol>
<section class="stylefig">
<h3>Figure 21-A</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_21_A.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 21-B</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_21_B.png" /></p>
</section>
<section class="stylefig">
<h3>Figure 21-C</h3>
<p><img
src="https://raw.githubusercontent.com/jonescompneurolab/jones-website/master/images/textbook/content/07_gamma/gamma_fig_21_C.png" /></p>
</section>
<p>Due to the higher variability in synaptic input timing, there is now
more variability in the temporal dynamics and frequency content seen in
the dipole signal (compare <a href="#figure-21-a">Figure 21-A</a> to <a
href="#figure-20-a">Figure 20-A</a>). This can also be seen in the
less-consistent 50 Hz gamma events in the spectrogram (compare <a
href="#figure-21-c">Figure 21-C</a> to <a href="#figure-20-d">Figure
20-D</a>). With the added noise, we also observe lower-frequency peaks
with relatively high power in the average PSD, though the intermittent
gamma events still yield the highest-power peak observed in the PSD
(compare <a href="#figure-21-b">Figure 21-B</a> to <a
href="#figure-20-c">Figure 20-C</a>).</p>
<p><a id="toc-10-2"></a></p>
<h3>10.2 Exercises for Further Exploration</h3>
<ul>
<li><p>Go back to the <code>gamma_L5weak_L2weak</code> configuration and
add recurrent synaptic connectivity between pyramidal neurons within a
layer (e.g., L5 Pyr -&gt; L5 Pyr weight = <code>0.00091e-4</code>); how
does that change the gamma rhythm? What happens as you change the
strength of this connection?</p></li>
<li><p>Add connectivity between Layer 2/3 and Layer 5. Is gamma
rhythmicity retained? Under what circumstances might gamma
persist?</p></li>
</ul>
<p><a id="toc-11"></a></p>
<h2>11. Have Fun Exploring your Own Data!</h2>
<p>We have <strong>not</strong> observed strong gamma activity in our
primary somatosensory cortex dipole data, and as such have not provided
an example data set to compare simulation results to. However,
simulation results can be compared to recorded data, as described in the
<a href="../05_erps/erps_in_gui.html">ERP Tutorial</a> and <a
href="../06_alpha_beta/gui.html">Alpha/Beta Tutorial</a>. Follow the
steps above using your data and make parameter adjustments based on your
own hypotheses.</p>
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent"
data-entry-spacing="0" role="list">
<div id="ref-buzsaki_mechanisms_2012" class="csl-entry" role="listitem">
Buzsáki, György, and Xiao-Jing Wang. 2012. <span>“Mechanisms of
<span>Gamma</span> <span>Oscillations</span>.”</span> <em>Annual Review
of Neuroscience</em> 35 (1): 203–25. <a
href="https://doi.org/10.1146/annurev-neuro-062111-150444">https://doi.org/10.1146/annurev-neuro-062111-150444</a>.
</div>
<div id="ref-cardin_driving_2009" class="csl-entry" role="listitem">
Cardin, Jessica A., Marie Carlén, Konstantinos Meletis, Ulf Knoblich,
Feng Zhang, Karl Deisseroth, Li-Huei Tsai, and Christopher I. Moore.
2009. <span>“Driving Fast-Spiking Cells Induces Gamma Rhythm and
Controls Sensory Responses.”</span> <em>Nature</em> 459 (7247): 663–67.
<a
href="https://doi.org/10.1038/nature08002">https://doi.org/10.1038/nature08002</a>.
</div>
<div id="ref-lee_distinguishing_2013" class="csl-entry" role="listitem">
Lee, Shane, and Stephanie R. Jones. 2013. <span>“Distinguishing
Mechanisms of Gamma Frequency Oscillations in Human Current Source
Signals Using a Computational Model of a Laminar Neocortical
Network.”</span> <em>Frontiers in Human Neuroscience</em> 7 (December).
<a
href="https://doi.org/10.3389/fnhum.2013.00869">https://doi.org/10.3389/fnhum.2013.00869</a>.
</div>
<div id="ref-vierling-claassen_computational_2010" class="csl-entry"
role="listitem">
Vierling-Claassen, Dorea, Jessica Cardin, Christopher I. Moore, and
Stephanie R. Jones. 2010. <span>“Computational <span>Modeling</span> of
<span>Distinct</span> <span>Neocortical</span> <span>Oscillations</span>
<span>Driven</span> by <span>Cell</span>-<span>Type</span>
<span>Selective</span> <span>Optogenetic</span> <span>Drive</span>:
<span>Separable</span> <span>Resonant</span> <span>Circuits</span>
<span>Controlled</span> by <span>Low</span>-<span>Threshold</span>
<span>Spiking</span> and <span>Fast</span>-<span>Spiking</span>
<span>Interneurons</span>.”</span> <em>Frontiers in Human
Neuroscience</em> 4 (November). <a
href="https://doi.org/10.3389/fnhum.2010.00198">https://doi.org/10.3389/fnhum.2010.00198</a>.
</div>
</div>
        <!-- footer area -->
        <!----------------->
        <div class="footer-area">
            <div class="previous-area" data-link="/website_redesign/content/06_alpha_beta/api.html">
                <div class="previous-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
                <div class="previous-text">
                    <p>Previous</p>
                    <a>6.2 API Tutorial of Alpha/Beta Rhythms</a>
                </div>
            </div>
            <div class="next-area" data-link="/website_redesign/content/07_gamma/gamma_in_api.html">
                <div class="next-text">
                    <p>Next</p>
                    <a>7.2 API Tutorial of Gamma Rhythms</a>
                </div>
                <div class="next-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
            </div>
        </div> <!-- close footer -->
    </div> <!-- close content -->
    </div> <!-- close content wrapper -->
</div> <!-- close main -->
<script>
    // ----------------------------------------
    // Manage footer
    // ----------------------------------------
    // This function will update the footer links when a page is loaded
    // locally so that naivagation remains functional without a server
    // Note: this solution is specific to MacOS
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.protocol === "file:") {
            // Get the current local directory path
            const currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            // Process both previous and next links
            document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
                const link = area.getAttribute('data-link');
                
                if (link && link.startsWith("/")) {
                    // Extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // Prepend root path to link
                    const resolvedLink = "file://" + rootPath + link;
                    area.setAttribute("data-link", resolvedLink);
                }
            });
        }
    });
    // Hide the area if data-link is 'None'
    document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
        if (area.getAttribute('data-link') === 'None') {
            area.style.display = 'none'; 
        }
    });

    // Redirect to the specified link
    document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
        area.addEventListener('click', function() {
            window.location.href = area.getAttribute('data-link');
        });
    });

    // ----------------------------------------
    // Manage sidebar
    // ----------------------------------------
    let isSidebarOpen = true; // Sidebar is initially open
    let isSidebarFullyOpen = true; // Sidebar is fully open
    const maxWidth = '350px';

    function toggleNav() {
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");
        const topbar = document.querySelector(".topbar");

        // Toggle sidebar state
        if (isSidebarOpen) {
            sidebar.style.width = "0";
            main.style.marginLeft = "0";
            topbar.style.marginLeft = "0";
            topbar.style.width = "100%";
            isSidebarFullyOpen = false;
        } else {
            sidebar.style.width = maxWidth;
            main.style.marginLeft = maxWidth;
                // match margin to new width
            topbar.style.marginLeft = maxWidth;
            topbar.style.width = `calc(100% - ${maxWidth})`;
                // adjust topbar width
        }

        // Toggle the sidebar state
        isSidebarOpen = !isSidebarOpen;

        // Store the sidebar state in localStorage
        localStorage.setItem("sidebarState", isSidebarOpen ? "open" : "closed");
    }

    // Always listen for the transitionend on the sidebar
    const sidebar = document.getElementById("mySidebar");
    sidebar.addEventListener('transitionend', function() {
        if (sidebar.style.width === maxWidth) {
            // Sidebar has fully opened
            isSidebarFullyOpen = true;
        } else {
            // Sidebar is not fully open
            isSidebarFullyOpen = false;
        }
    });

    // Open the sidebar on page load
    // -----------------------------

    // Apply sidebar state before the page renders
    // Added to help with initial page "flicker" as the position is
    // calculated and applied
    const savedState = localStorage.getItem("sidebarState");
    if (savedState === "closed") {
        document.body.classList.add("sidebar-closed");
    } else {
        document.body.classList.add("sidebar-open");
    }

    window.onload = function() {
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");
        const topbar = document.querySelector(".topbar");

        // Retrieve stored state
        const savedState = localStorage.getItem("sidebarState");

        // Determine initial state
        if (savedState === "closed") {
            sidebar.style.width = "0";
            main.style.marginLeft = "0";
            topbar.style.marginLeft = "0";
            topbar.style.width = "100%";
            isSidebarOpen = false;
            isSidebarFullyOpen = false;
        } else {
            sidebar.style.width = maxWidth;
            main.style.marginLeft = maxWidth;
            topbar.style.marginLeft = maxWidth;
            topbar.style.width = `calc(100% - ${maxWidth})`;
            isSidebarOpen = true;
            isSidebarFullyOpen = true;
        }

        // Disable transition for the initial state
        sidebar.style.transition = "none";
        main.style.transition = "none";
        topbar.style.transition = "none";

        // Re-enable transition for subsequent toggles
        setTimeout(() => {
            sidebar.style.transition = "width 0.5s";
            main.style.transition = "margin-left 0.5s";
            topbar.style.transition = "margin-left 0.5s, width 0.5s";
        }, 10);
    }

    function toggleSubmenu(event) {
        const header = event.target.closest('#sidebar-header');
            // Get the clicked header
        const submenu = header.nextElementSibling;
            // Get the submenu
        const toggleIcon = header.querySelector('.toggle-icon');
            // Get the icon

        if (submenu && submenu.classList.contains('submenu')) {
            submenu.classList.toggle('open'); 
                // Toggle the 'open' class to control visibility
            toggleIcon.textContent = submenu.classList.contains('open') ? '-' : '+'; 
                // Update icon
        }
    }

    // Resolve sidebar links for local development
    // -------------------------------------------
    // This function will update the sidebar links when a page is loaded
    // locally so that sidebar naivagation remains functional without a server
    // Note: this solution is specific to MacOS
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.protocol === "file:") {
            // get the current local directory path
            const currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            // get 'absolute' links with root of 'website_redesign'
            const links = document.querySelectorAll("#mySidebar a");
            links.forEach(link => {
                const href = link.getAttribute("href");

                if (href && href.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to link
                    const resolvedHref = "file://" + rootPath + href;
                    link.setAttribute("href", resolvedHref);
                }
            });

            // Update image sources for icons
            const images = document.querySelectorAll(".social-icons img, .menu-icons img");
            images.forEach(img => {
                const src = img.getAttribute("src");

                if (src && src.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to image source
                    const resolvedSrc = "file://" + rootPath + src;
                    img.setAttribute("src", resolvedSrc);
                }
            });
        }
    });

    // Custom tooltips for the sidebar
    // -------------------------------
    // Flag to track tooltip visibility
    let isTooltipVisible = false;

    // Add text to the 'sidebar-tooltip' attribute for sidebar anchor tags
    document.querySelectorAll('.sidebar a').forEach(anchor => {
        const cleanedText = anchor.textContent.replace(/[+\-]/g, '').trim();
        anchor.setAttribute('sidebar-tooltip', cleanedText);
    });

    // Handle sidebar tooltips
    document.querySelectorAll('.sidebar a').forEach(function(link) {
        link.addEventListener('mouseenter', function(event) {
            const tooltipText = event.target.getAttribute('sidebar-tooltip');
            
            if (!tooltipText || isTooltipVisible || !isSidebarFullyOpen) return; // Only show tooltip if none is visible

            // Check if the text is overflowing
            if (event.target.scrollWidth > event.target.offsetWidth) {
                const delay = 500; // Set the delay time (in ms), adjust as needed

                // Create the tooltip after the delay
                setTimeout(function() {
                    // Remove any existing tooltips
                    const existingTooltip = document.querySelector('.sidebar-tooltip');
                    if (existingTooltip) {
                        existingTooltip.remove();
                    }

                    // Create the tooltip element dynamically
                    const tooltip = document.createElement('div');
                    tooltip.classList.add('sidebar-tooltip');  // Use the existing class
                    tooltip.innerText = tooltipText;

                    // Append the tooltip to the sidebar container
                    const sidebarContainer = document.querySelector('.sidebar');
                    sidebarContainer.appendChild(tooltip);

                    // Get the position of the link and the sidebar container
                    const rect = event.target.getBoundingClientRect();
                    const sidebarRect = sidebarContainer.getBoundingClientRect();

                    // Position the tooltip relative to the sidebar container
                    tooltip.style.position = 'absolute';
                    tooltip.style.left = `${rect.left - sidebarRect.left + sidebarContainer.scrollLeft + 20}px`;
                    tooltip.style.top = `${rect.bottom - sidebarRect.top + sidebarContainer.scrollTop + 5}px`;

                    // Make sure the tooltip is visible
                    tooltip.style.opacity = '1';

                    // Set the flag to true indicating that the tooltip is visible
                    isTooltipVisible = true;
                }, delay); // Delay the tooltip creation
            }
        });

        link.addEventListener('mouseleave', function(event) {
            // Remove the tooltip when the mouse leaves
            const tooltip = document.querySelector('.sidebar-tooltip');
            if (tooltip) {
                tooltip.remove();
            }

            // Reset the flag to false when the tooltip is removed
            isTooltipVisible = false;
        });
    });

    // Close all open submenus in the sidebar
    // --------------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        // Function to close all open submenus in the navbar
        function closeAllSubmenus() {
            const allSubmenus = document.querySelectorAll('.submenu.open'); // Select all open submenus
            allSubmenus.forEach(submenu => {
                submenu.classList.remove('open'); // Remove 'open' class to collapse
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');
                if (toggleIcon) {
                    toggleIcon.textContent = '+'; // Reset icon to '+'
                }
            });
        }

        // Add functionality to collapse button (SVG icon)
        const collapseIcon = document.querySelector('.collapse-icon');
        if (collapseIcon) {
            collapseIcon.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent event propagation to avoid unwanted behavior
                closeAllSubmenus(); // Close all open submenus when the icon is clicked
            });
        }
    });

    // Keep the current page open in the sidebar
    // -----------------------------------------
    document.addEventListener("DOMContentLoaded", function () {
        // Get the full path relative to the 'content' folder
        const currentPage = window.location.pathname.split("/content/")[1].split("?")[0];

        // Find the active link using the full path
        const activeLink = document.querySelector(`#mySidebar a[href$='${currentPage}']`);

        if (activeLink) {
            // Apply the active class
            activeLink.classList.add("active");
             // Find the closest submenu
            const submenu = activeLink.closest('.submenu');

            if (submenu) {
                // Keep the submenu open
                submenu.classList.add('open');
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');

                if (toggleIcon) {
                    // Ensure the toggle icon reflects the open state
                    toggleIcon.textContent = '-';
                }
            }
        }
    });

    // ------------------------------
    // Font size buttons and dropdown
    // ------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        const content = document.getElementById("content");

        // Retrieve and apply the saved font size
        const savedFontSize = localStorage.getItem("fontSize");
        if (savedFontSize && content) {
            content.style.fontSize = savedFontSize + "px";
        }
    });

    function increaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
        const newSize = currentSize + 1;

        content.style.fontSize = newSize + "px";

        // save font size to localStorage
        localStorage.setItem("fontSize", newSize);
    }

    function decreaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
        const newSize = currentSize - 1;

        content.style.fontSize = newSize + "px";

        // save font size to localStorage
        localStorage.setItem("fontSize", newSize);
    }

    // Dropdown for font buttons
    function toggleDropdown() {
        const dropdownContent = document.querySelector('.dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    }

    // Open/close dropdown on click of the button
    document.getElementById('dropdownButton').onclick = function(event) {
        event.stopPropagation();  // Prevent the click from triggering the window.onclick event
        toggleDropdown();
    };

    // Close dropdown if clicking outside
    window.onclick = function(event) {
        const dropdownContent = document.querySelector('.dropdown-content');
        if (!event.target.closest('.dropdown')) {  // Close if click outside the dropdown
            dropdownContent.style.display = 'none';
        }
    };

    // ----------------------------------------
    // Toggle between light and dark themes
    // ----------------------------------------
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.querySelector('.theme-toggle');
        const sidebar = document.querySelector('.sidebar');
        const sunSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
            </svg>
        `;
        const moonSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                <path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
            </svg>
        `;

        // Check the saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
            themeToggle.innerHTML = savedTheme === 'dark' ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', savedTheme === 'dark');
        } else {
            // Default to light theme if no saved preference
            themeToggle.innerHTML = sunSVG;
        }

        // Add click event to toggle theme
        themeToggle.addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            themeToggle.innerHTML = isDarkMode ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        });
    });

    // ----------------------------------------
    // Add a clickable '#' for each heading 
    // that directs to that heading
    // ----------------------------------------
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(header => {
            if (!header.id) {
                let text = header.textContent.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]/g, '');
                header.id = text;
            }

            // Avoid adding duplicate links if the script runs multiple times
            if (!header.querySelector(".headerlink")) {
                let link = document.createElement("a");
                link.className = "headerlink";
                link.href = `#${header.id}`;
                link.title = "Link to this heading";
                link.textContent = " #"; // Space before # for spacing

                header.appendChild(link);
            }
        });
    });

</script>

<!------------------------ #
# Code syntax highlighting #
# ------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

<script>
    // Remove the leading whitespace/newlines around code blocks 
    // caused by the html structure used for readability
    document.addEventListener("DOMContentLoaded", function() {
        // Select all code blocks
        const codeBlocks = document.querySelectorAll('.code-cell code.language-python');

        codeBlocks.forEach(function(block) {
            // Apply syntax highlighting to the code block
            // Note: The below line is not needed with this setup
            //  but may be useful in the case that the method
            //  is later changed
            // Prism.highlightElement(block);

            // Get the code with highlighted classes
            const highlightedHTML = block.innerHTML;

            // Remove leading/trailing whitespace/newlines
            block.innerHTML = highlightedHTML.trim();
        });

        // Select all output-code blocks
        const outputBlocks = document.querySelectorAll('.output-cell .output-code');

        outputBlocks.forEach(function(block) {
            // Remove unwanted leading/trailing whitespace or newlines
            block.textContent = block.textContent.trim();
        });
    });

</script>

</body>
</html>