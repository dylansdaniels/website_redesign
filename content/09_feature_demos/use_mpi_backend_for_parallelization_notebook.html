<html><body>
<div class='markdown-cell'>
	<h1>9.7: Use MPI backend for Parallelization</h1>
<p>This example demonstrates how to use the MPI backend for simulating
dipoles using HNN-core.</p>
<p>The MPI backend allows running the simulation in parallel across
neurons in the network even with a single trial. For this, you will need
the <code>MPI related software &amp;lt;parallel&amp;gt;</code>
installed. Note that if you want to simulate in parallel across trials,
the Joblib backend allows this without the need to install and configure
MPI.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		# Authors: Mainak Jas <mjas@mgh.harvard.edu>
#          Blake Caldwell <blake_caldwell@brown.edu>
	</code>
</div>
<div class='markdown-cell'>
	<p>Let us import hnn_core</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		import os.path as op

import hnn_core
from hnn_core import simulate_dipole, jones_2009_model
	</code>
</div>
<div class='markdown-cell'>
	<p>Following
<code>the alpha example &amp;lt;sphx_glr_auto_examples_plot_simulate_alpha.py&amp;gt;</code>,
we add a ~10 Hz "bursty" drive starting at 50 ms and continuing to the
end of the simulation. Each burst consists of a pair (2) of spikes,
spaced 10 ms apart. The occurrence of each burst is jittered by a
random, normally distributed amount (20 ms standard deviation). We
repeat the burst train 10 times, each time with unique
randomization.</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		net = jones_2009_model()

weights_ampa = {'L2_pyramidal': 5.4e-5, 'L5_pyramidal': 5.4e-5}
net.add_bursty_drive(
    'bursty', tstart=50., burst_rate=10, burst_std=20., numspikes=2,
    spike_isi=10, n_drive_cells=10, location='distal',
    weights_ampa=weights_ampa, event_seed=278)
	</code>
</div>
<div class='markdown-cell'>
	<p>Finally, to simulate we use the
:class:<code>~hnn_core.parallel_backends.MPIBackend</code> class. This
will start the simulation across the number of processors (cores)
specified by <code>n_procs</code> using MPI. The
<code>&amp;#x27;mpiexec&amp;#x27;</code> launcher is used from
<code>openmpi</code>, which must be installed on the system</p>

</div>
<div class='code-cell'>
	<code class='language-python'>
		from hnn_core import MPIBackend

with MPIBackend(n_procs=2, mpi_cmd='mpiexec'):
    dpls = simulate_dipole(net, tstop=310., n_trials=1)

trial_idx = 0
dpls[trial_idx].plot()
	</code>
</div>
</body></html>